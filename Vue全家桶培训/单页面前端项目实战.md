# 单页面前后端分离应用实战
单页Web应用（single page web application，SPA），顾名思义就是只有一个html页面的web应用，页面跳转，样式动态渲染等用户交互，全部由JavaScript来控制，这样不需要刷新整个页面实现跳转，页面静态资源不需要重复引用，需要渲染这么内容是异步加载，所以速度快，体验更好，web app能有native app的速度和流畅。由于是单页面，如果所有代码都写在一个页面的话显然是不合理的，所以模块化就显得非常重要。
## 实战项目会员管理系统介绍
会员管理系统，基于**Vue+Vuex+Element+Axios**开发的前后端分离，由**MockJS**服务提供模拟数据接口。包括**登录、注销、修改密码、首页、会员管理、供应商管理、商品管理、用户管理**模块。
示例项目代码已开源到码云上：https://gitee.com/pjhpeter/vue-project.git

效果如下：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/194640_677241b8_5449551.png "屏幕截图.png")

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/194941_ddefad9e_5449551.png "屏幕截图.png")

## MockJS介绍
### 什么是MockJS
MockJS是可以根据一定规则生成虚拟数据的工具，前后端分离的开发模式，前端开发人员都是根据Web API文档用MockJS来模拟真实数据，从而实现模拟向后端发送请求，获取响应数据的。

官方文档在这：https://github.com/nuysoft/Mock/wiki

### MockJS语法
```json
"name|rule": value
```
MockJS语法采用数据模板定义规范（DTD），分成三部分

+ name：名称
+ rule：规则，同样的规则根据value的数据类型不同会有不同效果
+ value：值

值可以用@占位符来表明调用MockJS的Random对象方法

### 举个例子

1. 创建mock-demo项目，并用Yarn初始化
2. 按照MockJS
```cmd
yarn add mockjs -D
```
3. 在项目根目录创建test.js
```js
const Mock = require('mockjs')

const data = Mock.mock({
    'list|10': [ // list的规则为10，list是数组，该规则的意思是创建10个元素
        {
            'id': 1,
            'name': '张三'
        }
    ]
})

console.log(data)
```
4. 用NodeJS来运行看效果
```cmd
node test
```

效果如下：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/202514_cde583c6_5449551.png "屏幕截图.png")

> list数组生成了10个元素，但是每个元素都是一样的，这显然不是我们想要的模拟真实数据

5. 再修改一下test.js

```js
const Mock = require('mockjs')

const data = Mock.mock({
    'list|10': [ // list的规则为10，list是数组，该规则的意思是创建10个元素
        {
            'id|+1': 1, // id添加了+1的规则，id是数字类型，所以会从value开始自增1
            'name': '@cname' // value用了@占位符，这里代表调用了Mock的Random对象的cname方法，随机生成中文姓名
        }
    ]
})

console.log(data)
```

再执行一次

```cmd
node test
```

效果如下：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/203327_fd08068c_5449551.png "屏幕截图.png")

## RAP2

### 什么是RAP2

RAP2是有阿里巴巴提供的免费MockJS数据模拟服务平台。

官网在这：http://rap2.taobao.org/

### RAP2使用

1. 注册账号并登录

2. 新建仓库mock-demo

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/204604_7d59fc14_5449551.png "屏幕截图.png")

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/204744_414da80a_5449551.png "屏幕截图.png")

3. 进入mock-demo仓库新建模块

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/205014_b5afcf53_5449551.png "屏幕截图.png")

4. 新建接口

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/205241_68260d42_5449551.png "屏幕截图.png")

5. 点击编辑，找到响应内容一栏，点击导入

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/205432_9d5b2a7f_5449551.png "屏幕截图.png")

6. 将写入json数据

```json
{
    "list|10": [
        {
            "id|+1": 1,
            "name": "@cname"
        }
    ]
}
```

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/205722_a907c530_5449551.png "屏幕截图.png")

保存后效果如下：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/205838_aef2fa7d_5449551.png "屏幕截图.png")

> list只有1个元素，并不是我们想要的效果，我们的规则是要给list创建10个元素
> 原因是RAP2的bug，导入JSON的时候，规则会被忽略
> 解决方法在上面生成的响应内容中修改

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/210239_ff84815d_5449551.png "屏幕截图.png")

这时响应数据就是我们想要的了

> 编辑完接口一定要记得保存

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/210350_7e904262_5449551.png "屏幕截图.png")

7. 测试接口

点击下图的地址就可以测试接口，**但是只能测试get请求**

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/210817_c7489bce_5449551.png "屏幕截图.png")

效果如下：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/211014_3d44cb15_5449551.png "屏幕截图.png")

> 记住红色圈围住的地址，这个就是你的仓库地址，以后在这个仓库创建的所有接口都要用这个地址来访问
> 这里只是简单普及一下MockJS的使用，具体怎么在前端开发中使用后面做项目会讲解

## 项目环境搭建
### 安装Vue CLI
**这里为了演示方便选择的全局安装，真实项目中最好还是局部安装**
```cmd
yarn global add @vue/cli -D
```

### 基于Vue CLI 4 .x创建项目
创建项目vue-member-manager
```cmd
vue create vue-member-manager
```
+ 选这4项：

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/212116_d975ded3_5449551.png "屏幕截图.png")

+ 不用历史路由
+ 选第4项

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/212434_72025a77_5449551.png "屏幕截图.png")

+ 选第1项

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/212538_8859f447_5449551.png "屏幕截图.png")

+ 选第1项

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/212715_c0b55b25_5449551.png "屏幕截图.png")

### 启动测试
```cmd
cd vue-member-manager
yarn serve
```

看到效果就创建成功了

![输入图片说明](https://images.gitee.com/uploads/images/2019/1226/213534_fa9921c2_5449551.png "屏幕截图.png")

### 项目初始化
#### 修改public/index.html
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>会员管理系统</title>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
```
#### 更换ICO图标
+ 找一个.ico小图标替换public/favicon.ico
+ 然后清除浏览器缓存，一定要选**时间不限**
#### 删除这3个文件
![输入图片说明](https://images.gitee.com/uploads/images/2019/1227/004428_404f7d01_5449551.png "屏幕截图.png")
#### 修改src/router/index.js
```js
import Vue from "vue";
import VueRouter from "vue-router";

Vue.use(VueRouter);

const routes = [];

const router = new VueRouter({
  routes
});

export default router;
```
#### 修改src/App.vue
```vue
<template>
  <div id="app"></div>
</template>

<style></style>
```
#### 配置vue.config.js
在项目根目录下创建vue.config.js
```js
// Vue CLI将webpack.config.js封装起来，不建议我们直接修改，用vue.config.js来代替
module.exports = {
    devServer: {
        port: 8888, // 端口号
        host: 'localhost', // 主机名
        https: false, // 是否启用https协议访问应用
        open: true // 是否项目启动后马上打开浏览器访问
    },

    lintOnSave: false, // 是否开启保存时进行代码检查
    productionSourceMap: false // 打包时不会生成.map文件，加快打包速度
}
```
> Vue CLI将webpack.config.js封装起来，不建议我们直接修改，用vue.config.js来代替

#### 安装第三方库
+ 安装Axios
```cmd
yarn add axios
```
+ 安装Element UI
```cmd
yarn add element-ui
```
Element UI时基于Vue的前端UI组件，Vue本身不具备UI组件功能，使用Element UI给Vue提供UI功能。
Elemnt UI官网在这：https://element.eleme.cn/

#### 整合Element UI
+ 修改src/main.js
```js
import Vue from "vue";
import ElementUI from "element-ui"; // 引入Element UI
import "element-ui/lib/theme-chalk/index.css"; // 引入Element UI的默认样式
import App from "./App.vue";
import router from "./router";
import store from "./store";

// 使用Element UI
Vue.use(ElementUI);

// 消息提示环境配置，是否生产环境
// 开发环境下，Vue会提供很多警告信息，方便调试代码
// 生产环境下，Vue只会提供必要的错误信息
// process.env是全局环境变量，NODE_ENV是production或者development
Vue.config.productionTip = process.env.NODE_ENV === 'production';

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount("#app");
```
#### 安装两个vscode插件
+ HTML CSS Support
提供HTML和CSS的快捷提示

![输入图片说明](https://images.gitee.com/uploads/images/2019/1227/003911_b51c1f89_5449551.png "屏幕截图.png")

+ Element UI Snippets
提供Element UI的快捷提示

![输入图片说明](https://images.gitee.com/uploads/images/2019/1227/004005_fe8e7daa_5449551.png "屏幕截图.png")

### 封装Axios
#### 编写request.js
在src目录下创建uitls目录，然后创建src/utils/request.js
```js
// 引入axios
import axios from 'axios'

// 创建一个axios对象
const request = axios.create({
    // 请求配置参考: https://github.com/axios/axios#request-config
    // baseURL参数是所有请求的路径前缀
    // 比如baseURL: '/dev-api'，调用axios.get('/test')，真正的请求路径是/dev-api/test
    baseURL: '/',
    timeout: 5000
})

// 导出request对象
export default request
```
#### 测试一下
1. 在public目录下创建db.json
```json
[
    {"id": 1, "name": "嬴政"},
    {"id": 2, "name": "百里守约"},
    {"id": 3, "name": "亚瑟"}
]
```
2. 在src目录下创建api目录，然后创建src/api/test.js
```js
// 引入request
import request from '@/utils/request' // @符号是代表src的绝对路径

// public目录下的内容打包后会在项目根目录中，所以这里不需要加public路径
request.get('http://localhost:8888/db.json').then(response => {
    console.log(response.data);
})
```
3. 修改App.vue
```vue
<template>
  <div id="app"></div>
</template>

<script>
// 引入test.js测试axios封装
import testAPI from '@/api/test'

export default {
  
}
</script>

<style></style>
```
4. 启动服务查看结果
```cmd
yarn serve
```
![输入图片说明](https://images.gitee.com/uploads/images/2019/1227/012859_c98232c2_5449551.png "屏幕截图.png")